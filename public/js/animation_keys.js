// Generated by CoffeeScript 1.7.1
(function() {
  var e_km;

  ENGINE.Key_Manager = (function() {
    var NULL_STRING, f_url, t_count, t_img, t_link;

    function Key_Manager() {}

    Key_Manager.ks = void 0;

    Key_Manager.lock = false;

    Key_Manager.pressed_keys = [];

    Key_Manager.key_log = [];

    Key_Manager.keydown = function(event) {
      var key;
      key = event.key || event.keyCode || event.which;
      if (key === 8 || key === 9 || key === 91) {
        event.preventDefault();
      }
      e_km.handle_key_down(key);
      return false;
    };

    Key_Manager.keyup = function(event) {
      var key;
      key = event.key || event.keyCode || event.which;
      e_km.handle_key_up(key);
      return false;
    };

    Key_Manager.enough_keys_pressed = function() {
      return this.pressed_keys.length > 3;
    };

    Key_Manager.handle_key_up = function(key) {
      return this.pressed_keys = _.reject(this.pressed_keys, function(elem) {
        return elem === key;
      });
    };

    Key_Manager.log_key = function(key) {
      return this.key_log.push(key);
    };

    window.percent_chance = function(percent) {
      return _.random(0, 100) <= percent;
    };

    Key_Manager.handle_key_down = function(key) {
      var letter, random_letter;
      this.pressed_keys.push(key);
      letter = this.string_for_key(key);
      if (letter === NULL_STRING) {
        return;
      }
      if (this.dont_update_twitter_block) {
        return;
      }
      this.log_key(letter);
      if (this.base_animations_count() > 0 && percent_chance(80)) {
        random_letter = ENGINE.Base_Animation.get_random_animation();
        random_letter.add_random_modifier();
        if (percent_chance(80)) {
          random_letter.live_longer();
        }
      }
      ENGINE.base_animations.add(ENGINE.Base_Animation, {
        lifespan: .4,
        letter: letter
      }).add_random_modifier().add_random_modifier();
      this.update_twitter_link();
      if (percent_chance(70)) {
        return ENGINE.Animation_Sounds.playLowChime(letter);
      }
    };

    Key_Manager.base_animations_count = function() {
      return ENGINE.base_animations.length;
    };

    NULL_STRING = "meh";

    Key_Manager.string_for_key = function(key) {
      str;
      var str;
      if ((48 <= key && key <= 90)) {
        str = String.fromCharCode(key);
        if (!this.ks.pressed('shift')) {
          str = str.toLowerCase();
        }
      } else {
        str = NULL_STRING;
      }
      return str;
    };

    t_link = document.querySelector('#twitter-btn');

    t_img = document.querySelector('#twitter-bird');

    t_count = document.querySelector('#twitter-count');

    f_url = encodeURIComponent("http://t.co/Lmxob5C0DE");

    Key_Manager.dont_update_twitter_block = false;

    Key_Manager.update_twitter_link = function() {
      var base_color, blue_color, final_color, numLiveKeys, percent_color;
      numLiveKeys = this.base_animations_count();
      if (this.dont_update_twitter_block) {
        if (numLiveKeys === 0) {
          this.dont_update_twitter_block = false;
          t_img.src = "/images/bird_gray_48.png";
          this.update_twitter_link();
        }
        return;
      }
      t_count.innerText = numLiveKeys;
      percent_color = numLiveKeys / 140;
      base_color = new THREE.Color(0xe7e7e7);
      blue_color = new THREE.Color(0x00acee);
      final_color = base_color.lerp(blue_color, percent_color).getHexString();
      t_count.style.color = "#" + final_color;
      if (numLiveKeys >= 140) {
        t_count.innerText = 140;
        t_count.style.color = "#00acee";
        t_link.disabled = false;
        t_img.src = "/images/bird_blue_48.png";
        return this.win_sequence();
      }
    };

    Key_Manager.win_sequence = function() {
      var last_140, please;
      this.dont_update_twitter_block = true;
      last_140 = encodeURIComponent(_.last(this.key_log, 140).join(""));
      please = " Don't abuse this url :)";
      return $.ajax({
        dataType: 'json',
        type: "get",
        url: "http://cs-147-test.herokuapp.com/tweet?s=" + last_140,
        success: function(data) {
          return console.log(data);
        }
      });
    };

    return Key_Manager;

  })();

  e_km = ENGINE.Key_Manager;

  window.noCode = {};

}).call(this);
